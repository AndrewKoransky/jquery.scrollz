/*! jQuery Scrollz - v1.0.1 - 2012-08-18
* https://github.com/zippy1978/jquery.scrollz
* Copyright (c) 2012 Gilles Grousset; Licensed MIT, GPL */
(function(a){function c(){return"ontouchstart"in document.documentElement}function d(a){return a.height()}function e(a){var b=h(a,"contentWrapper"),c=h(a,"pullHeader");return c?c.outerHeight(!0):0}function f(a,b){var d=a.data("options");if(!c()&&d.emulateTouchEvents)switch(b){case"touchstart":return"mousedown";case"touchend":return"mouseup";case"touchmove":return"mousemove"}return b}function g(a,b,c){var d=a.data("markup");d||(d={},a.data("markup",d)),d[b]=c}function h(a,b){var c=a.data("markup");return c?c[b]:null}function i(a,b,c){var d=a.data("tracking");d||(d={},a.data("tracking",d)),d[b]=c}function j(a,b){var c=a.data("tracking");return c?c[b]:null}function k(a){i(a,"startTouchTime",null),i(a,"startTouchY",null),i(a,"previousTouchTime",null),i(a,"previousTouchY",null),i(a,"lastTouchTime",null),i(a,"lastTouchY",null)}function l(a){a.attr("unselectable","on").css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none","-ms-user-select":"none"}).each(function(){this.onselectstart=function(){return!1}})}function m(a,b){var c=a.data("options"),d=e(a);return c.pull&&b<d?d:b}function n(b){var c=b.data("options"),f=a('<div class="scrollz-content-wrapper"/>'),h=a('<div class="scrollz-container"/>');h.css("height",d(b)),h.css("overflow-x","hidden"),h.css("overflow-y","hidden"),c.styleClass&&h.addClass(c.styleClass),b.wrap(h).wrap(f),b.css("overflow-y","visible"),f=b.parent(),h=f.parent();var i=a('<div class="scrollz-thumb"></div>');i.css("position","absolute"),h.prepend(i),i=h.find(".scrollz-thumb"),i.hide(),b.css("height","auto"),b.css("min-height",d(b)),g(b,"contentWrapper",f),g(b,"container",h),g(b,"scrollThumb",i);if(c.pull){var j=a(c.pullHeaderHTML.initial);j.addClass("scrollz-pull-header").addClass("initial"),f.prepend(j),h.scrollTop(e(b)),l(h),g(b,"pullHeader",f.children(".scrollz-pull-header"))}}function o(b,c){var d=b.data("options"),e=h(b,"contentWrapper"),f=e.children(".scrollz-pull-header");f.hasClass(c)||f.replaceWith(a(d.pullHeaderHTML[c]).addClass("scrollz-pull-header").addClass(c)),g(b,"pullHeader",e.children(".scrollz-pull-header")),b.data("pullHeaderState",c)}function p(a){var b=a.data("pullHeaderState");return b||(b="initial"),b}function q(a){var b=a.data("options"),c=h(a,"container"),d=e(a);b.pull&&c.scrollTop()<d&&p(a)!=="waiting"&&(c.scrollTop()<d/2?(o(a,"waiting"),a.trigger("pulled")):c.animate({scrollTop:d},"fast"))}function r(a){var b=a.data("options"),c=h(a,"container"),d=j(a,"previousTouchY"),e=j(a,"lastTouchY"),f=j(a,"previousTouchTime"),g=new Date-f,i=d-e,k=Math.abs(i/g);if(b.inertia&&k>.5){var l=Math.pow(k,2)*Math.abs(i)*1.25;i<0&&(l*=-1),c.stop(!0,!0),c.animate({scrollTop:m(a,c.scrollTop()+l)},{duration:k*500,easing:"easeOutCubic"})}}function s(a,b){if(p(b)!=="waiting"){var d=b.data("options"),e=h(b,"container");e.stop(),c()?i(b,"startTouchY",a.originalEvent.targetTouches[0].screenY):i(b,"startTouchY",a.screenY),i(b,"startTouchTime",new Date),i(b,"previousTouchY",j(b,"startTouchY")),i(b,"previousTouchTime",j(b,"startTouchTime")),i(b,"lastTouchY",j(b,"startTouchY")),i(b,"lastTouchTime",j(b,"startTouchTime")),i(b,"initialScrollPosition",e.scrollTop())}}function t(a,b){var d=h(b,"container"),e=j(b,"startTouchY"),f=j(b,"lastTouchY"),g=j(b,"lastTouchTime"),k=j(b,"initialScrollPosition");if(e){i(b,"previousTouchY",f),i(b,"previousTouchTime",g);var l=0;c()?(l=e-a.originalEvent.changedTouches[0].screenY+k,i(b,"lastTouchY",a.originalEvent.targetTouches[0].screenY)):(l=e-a.screenY+k,i(b,"lastTouchY",a.screenY)),i(b,"lastTouchTime",new Date),d.scrollTop(l)}}function u(a,b){var c=h(b,"container"),d=j(b,"startTouchY"),f=j(b,"lastTouchY"),g=j(b,"initialScrollPosition");if(!d)return;var i=e(b);d<f&&c.scrollTop()<i?q(b):r(b),k(b)}function v(a,b){if(p(b)!=="waiting"){var c=h(b,"container"),d=j(b,"initialScrollPosition"),f=0;a.type==="mousewheel"?f=a.originalEvent.screenY-(a.originalEvent.screenY+a.originalEvent.wheelDeltaY):f=a.originalEvent.screenY-(a.originalEvent.screenY+a.originalEvent.detail*-1*3),c.scrollTop()+f<e(b)&&(f*=.05),c.scrollTop(c.scrollTop()+f)}}function w(a,b){var c=b.data("options"),d=h(b,"container"),f=h(b,"contentWrapper"),g=h(b,"scrollThumb");d.scrollTop()+d.height()===d.get(0).scrollHeight&&b.trigger("bottomreached"),c.pull&&(d.scrollTop()<e(b)/2?o(b,"release"):o(b,"initial"));var i=e(b);if(d.scrollTop()>=i){var j=b.children().first(),k=b.children().last();j&&parseInt(j.css("marginTop"),10)>=0&&b.css("padding-top","1px"),k&&parseInt(k.css("marginBottom"),10)>=0&&b.css("padding-bottom","1px"),g.height(d.innerHeight()/f.outerHeight(!0)*(d.innerHeight()+i)-(g.outerHeight(!0)-g.outerHeight())),g.css("top",d.position().top+(d.scrollTop()-i)/f.outerHeight(!0)*d.innerHeight()),g.css("left",d.position().left+d.width()-g.outerWidth(!0))}else g.hide()}function x(a,b){var c=h(b,"container"),d=h(b,"scrollThumb");c.scrollTop()>e(b)&&(d.stop(!0,!0),d.fadeIn(500))}function y(a,b){var d=h(b,"scrollThumb");d.stop(!0,!0),d.delay(300).fadeOut(1e3);var e=j(b,"startTouchY");!c()&&!e&&q(b)}var b={init:function(b){var c=a.extend({pull:!1,pullHeaderHTML:{initial:'<div><div class="icon"/><div class="label">Pull to refresh</div></div>',release:'<div><div class="icon"/><div class="label">Release to refresh</div></div>',waiting:'<div><div class="icon"/><div class="label">Refreshing...</div></div>'},inertia:!0,emulateTouchEvents:!1},b);a.easing.easeOutCubic===undefined&&(a.easing.easeOutCubic=function(a,b,c,d,e){return d*((b=b/e-1)*b*b+1)+c});if(!a.event.special.scrollstart&&!a.event.special.scrollend){var d=a.event.special,e="D"+ +(new Date),g="D"+(+(new Date)+1);d.scrollstart={setup:function(){var b,c=function(c){var e=this,f=arguments;b?clearTimeout(b):(c.type="scrollstart",a.event.handle.apply(e,f)),b=setTimeout(function(){b=null},d.scrollstop.latency)};a(this).bind("scroll",c).data(e,c)},teardown:function(){a(this).unbind("scroll",a(this).data(e))}},d.scrollstop={latency:300,setup:function(){var b,c=function(c){var e=this,f=arguments;b&&clearTimeout(b),b=setTimeout(function(){b=null,c.type="scrollstop",a.event.handle.apply(e,f)},d.scrollstop.latency)};a(this).bind("scroll",c).data(g,c)},teardown:function(){a(this).unbind("scroll",a(this).data(g))}}}return this.each(function(){var b=a(this);if(!b.data("scrollz")){b.data("options",c),n(b);var d=h(b,"container");i(b,"initialScrollPosition",d.scrollTop()),d.bind(f(b,"touchstart"),function(a){s(a,b)}),d.bind(f(b,"touchmove"),function(a){a.preventDefault(),t(a,b)}),d.bind(f(b,"touchend"),function(a){a.preventDefault(),u(a,b)}),a("*").not(d).bind(f(b,"touchend"),function(a){u(a,b)}),d.bind("mousewheel DOMMouseScroll",function(a){a.preventDefault(),v(a,b)}),d.scroll(function(a){w(a,b)}),d.bind("scrollstart",function(a){x(a,b)}),d.bind("scrollstop",function(a){y(a,b)}),b.data("scrollz",!0)}})},height:function(b){return this.each(function(){var c=a(this);if(c.data("scrollz")){var d=c.data("options"),e=h(c,"container");e.height(b),c.css("min-height",e.css("height"))}})},hidePullHeader:function(){return this.each(function(){var b=a(this);if(b.data("scrollz")){var c=b.data("options"),d=h(b,"container");c.pull&&d.animate({scrollTop:e(b)},"fast",function(){o(b,"initial")})}})}};a.fn.scrollz=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):typeof c=="object"||!c?b.init.apply(this,arguments):(a.error("Method "+c+" does not exist"),null)}})(jQuery);